<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Steam Crypto — Каталог игр</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      background-color: #1b1b2f;
      font-family: 'Arial', sans-serif;
      margin: 0;
      padding: 20px;
      color: #f5f5f5;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
      font-size: 28px;
    }
    .catalog {
      display: flex;
      flex-direction: column;
      gap: 25px;
    }
    .game-card {
      background: #2c2c3a;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      overflow: hidden;
      padding: 20px;
      text-align: center;
      transition: transform 0.2s ease;
    }
    .game-card:hover {
      transform: translateY(-5px);
    }
    .game-card img {
      width: 100%;
      max-width: 320px;
      border-radius: 8px;
      margin-bottom: 15px;
    }
    .game-title {
      font-size: 22px;
      margin: 10px 0 5px;
    }
    .game-description {
      font-size: 14px;
      color: #cfcfcf;
      margin-bottom: 10px;
    }
    .game-price {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 15px;
    }
    .buy-button {
      padding: 12px 25px;
      background: linear-gradient(135deg, #00c6ff, #0072ff);
      color: white;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .buy-button:hover {
      background: linear-gradient(135deg, #0072ff, #00c6ff);
    }
  </style>
</head>
<body>

<h1>🎮 Каталог игр</h1>
<div class="catalog" id="catalog"></div>

<script>
  Telegram.WebApp.ready();

const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
  manifestUrl: 'https://aklss-code.github.io/steam-crypto/tonconnect-manifest.json',
  uiOptions: {
    twaReturnUrl: Telegram.WebApp.initDataUnsafe?.user?.username || window.location.href
  }
});
  const games = [
    {
      name: "Half-Life 2",
      description: "Культовая научно-фантастическая стрелялка от Valve.",
      priceTon: 0.99,
      image: "https://cdn.cloudflare.steamstatic.com/steam/apps/220/header.jpg"
    },
    {
      name: "Portal",
      description: "Головоломка с портальной пушкой от создателей Half-Life.",
      priceTon: 2.1,
      image: "https://cdn.cloudflare.steamstatic.com/steam/apps/400/header.jpg"
    }
  ];

  const catalog = document.getElementById('catalog');

  games.forEach(game => {
    const card = document.createElement('div');
    card.className = 'game-card';
    card.innerHTML = `
      <img src="${game.image}" alt="${game.name}">
      <div class="game-title">${game.name}</div>
      <div class="game-description">${game.description}</div>
      <div class="game-price">💰 ${game.priceTon} TON</div>
      <button class="buy-button" onclick="buy('${game.name}', ${game.priceTon})">Купить</button>
    `;
    catalog.appendChild(card);
  });

  async function buy(gameName, priceTon) {
    try {
      const wallet = await tonConnectUI.connectWallet();
      if (!wallet) {
        alert('Кошелек не подключен.');
        return;
      }

      const tx = {
        validUntil: Math.floor(Date.now() / 1000) + 600,
        messages: [{
          address: 'EQAIrAFcv8a8rU2eNUwZSn-Bwoiifx6uQ8P4wWZsnBxDKPZz', // <-- замени на свой TON-кошелек!
          amount: String(Math.floor(priceTon * 1_000_000_000)),
          payload: ''
        }]
      };

      const result = await tonConnectUI.sendTransaction(tx);
      console.log('✅ Транзакция отправлена:', result);

      Telegram.WebApp.sendData(JSON.stringify({
        action: 'paid',
        game: gameName,
        tx: result
      }));

      Telegram.WebApp.close();
    } catch (err) {
      console.error('❌ Ошибка при оплате:', err);
      alert('Ошибка при оплате или операция отменена.');
    }
  }
</script>

</body>
</html>

