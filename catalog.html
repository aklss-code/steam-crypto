<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Каталог игр</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f5f5f5;
    }

    .game-card {
      background: white;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 10px;
      margin: 10px;
      width: 250px;
      display: inline-block;
      vertical-align: top;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      cursor: pointer;
      position: relative;
      transition: transform 0.2s;
    }
    .game-card:hover {
      transform: scale(1.03);
    }
    .game-cover {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 10px;
    }
    .new-tag {
      position: absolute;
      top: 10px;
      left: 10px;
      background: #ff4757;
      color: white;
      padding: 3px 7px;
      font-size: 12px;
      font-weight: bold;
      border-radius: 5px;
    }
    #games-container {
      margin-top: 20px;
    }
    button {
      margin-top: 10px;
      padding: 8px 15px;
      border: none;
      background: #4CAF50;
      color: white;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background: #45a049;
    }

    /* Модальное окно */
    #gameModal {
      display: none;
      position: fixed;
      top: 5%;
      left: 5%;
      width: 90%;
      height: 90%;
      background: white;
      padding: 20px;
      border-radius: 15px;
      z-index: 1000;
      overflow-y: auto;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    #modalClose {
      cursor: pointer;
      float: right;
      font-size: 24px;
    }
    #modalImage {
      width: 100%;
      max-height: 300px;
      object-fit: cover;
      border-radius: 10px;
    }
  </style>
</head>

<body>

  <h1>Каталог игр</h1>

  <div id="games-container"></div>

  <!-- Модальное окно -->
  <div id="gameModal">
    <span id="modalClose" onclick="closeModal()">❌</span>
    <h2 id="modalTitle"></h2>
    <img id="modalImage" />
    <p id="modalDescription"></p>
    <p id="modalPrice"></p>
    <button id="buyButton">Купить</button>
  </div>

  <script>
    let gamesDB = {}; 

    fetch('games_db.json')
      .then(response => response.json())
      .then(data => {
        gamesDB = data;
        renderGames();
      });

    function renderGames() {
      const container = document.getElementById('games-container');
      container.innerHTML = '';

      Object.keys(gamesDB).forEach(gameName => {
        const game = gamesDB[gameName];

        const card = document.createElement('div');
        card.className = 'game-card';
        card.onclick = () => showGameDetails(gameName);

        card.innerHTML = `
          ${game.is_new ? '<div class="new-tag">Новинка</div>' : ''}
          <img src="${game.cover_url}" alt="${gameName}" class="game-cover" />
          <h3>${gameName}</h3>
          <p><strong>${game.price_ton} TON</strong></p>
          <button onclick="event.stopPropagation(); showGameDetails('${gameName}')">Подробнее</button>
        `;

        container.appendChild(card);
      });
    }

    function showGameDetails(gameName) {
      const game = gamesDB[gameName];

      document.getElementById('modalTitle').innerText = gameName;
      document.getElementById('modalImage').src = game.cover_url;
      document.getElementById('modalDescription').innerText = game.description;
      document.getElementById('modalPrice').innerHTML = `<strong>Цена: ${game.price_ton} TON</strong>`;

      document.getElementById('buyButton').onclick = function(event) {
        event.stopPropagation();
        buyGame(gameName);
      };

      document.getElementById('gameModal').style.display = 'block';
    }

    function closeModal() {
      document.getElementById('gameModal').style.display = 'none';
    }

    function buyGame(gameName) {
      alert(`Вы выбрали покупку игры: ${gameName}`);
      // Здесь потом будет window.Telegram.WebApp.sendData(gameName);
    }
  </script>

</body>
</html>

