<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Steam Crypto â€” ÐšÐ°Ñ‚Ð°Ð»Ð¾Ð³ Ð¸Ð³Ñ€</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      background-color: #1b1b2f;
      font-family: 'Arial', sans-serif;
      margin: 0;
      padding: 20px;
      color: #f5f5f5;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
      font-size: 28px;
    }
    .catalog {
      display: flex;
      flex-direction: column;
      gap: 25px;
    }
    .game-card {
      background: #2c2c3a;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      overflow: hidden;
      padding: 20px;
      text-align: center;
      transition: transform 0.2s ease;
    }
    .game-card:hover {
      transform: translateY(-5px);
    }
    .game-card img {
      width: 100%;
      max-width: 320px;
      border-radius: 8px;
      margin-bottom: 15px;
    }
    .game-title {
      font-size: 22px;
      margin: 10px 0 5px;
    }
    .game-description {
      font-size: 14px;
      color: #cfcfcf;
      margin-bottom: 10px;
    }
    .game-price {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 15px;
    }
    .buy-button {
      padding: 12px 25px;
      background: linear-gradient(135deg, #00c6ff, #0072ff);
      color: white;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .buy-button:hover {
      background: linear-gradient(135deg, #0072ff, #00c6ff);
    }
  </style>
</head>
<body>

<h1>ðŸŽ® ÐšÐ°Ñ‚Ð°Ð»Ð¾Ð³ Ð¸Ð³Ñ€</h1>
<div class="catalog" id="catalog"></div>

<script>
  Telegram.WebApp.ready();

const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
  manifestUrl: 'https://aklss-code.github.io/steam-crypto/tonconnect-manifest.json',
  uiOptions: {
    twaReturnUrl: Telegram.WebApp.initDataUnsafe?.user?.username || window.location.href
  }
});
  const games = [
    {
      name: "Half-Life 2",
      description: "ÐšÑƒÐ»ÑŒÑ‚Ð¾Ð²Ð°Ñ Ð½Ð°ÑƒÑ‡Ð½Ð¾-Ñ„Ð°Ð½Ñ‚Ð°ÑÑ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ ÑÑ‚Ñ€ÐµÐ»ÑÐ»ÐºÐ° Ð¾Ñ‚ Valve.",
      priceTon: 0.99,
      image: "https://cdn.cloudflare.steamstatic.com/steam/apps/220/header.jpg"
    },
    {
      name: "Portal",
      description: "Ð“Ð¾Ð»Ð¾Ð²Ð¾Ð»Ð¾Ð¼ÐºÐ° Ñ Ð¿Ð¾Ñ€Ñ‚Ð°Ð»ÑŒÐ½Ð¾Ð¹ Ð¿ÑƒÑˆÐºÐ¾Ð¹ Ð¾Ñ‚ ÑÐ¾Ð·Ð´Ð°Ñ‚ÐµÐ»ÐµÐ¹ Half-Life.",
      priceTon: 2.1,
      image: "https://cdn.cloudflare.steamstatic.com/steam/apps/400/header.jpg"
    }
  ];

  const catalog = document.getElementById('catalog');

  games.forEach(game => {
    const card = document.createElement('div');
    card.className = 'game-card';
    card.innerHTML = `
      <img src="${game.image}" alt="${game.name}">
      <div class="game-title">${game.name}</div>
      <div class="game-description">${game.description}</div>
      <div class="game-price">ðŸ’° ${game.priceTon} TON</div>
      <button class="buy-button" onclick="buy('${game.name}', ${game.priceTon})">ÐšÑƒÐ¿Ð¸Ñ‚ÑŒ</button>
    `;
    catalog.appendChild(card);
  });

  async function buy(gameName, priceTon) {
    try {
      const wallet = await tonConnectUI.connectWallet();
      if (!wallet) {
        alert('ÐšÐ¾ÑˆÐµÐ»ÐµÐº Ð½Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½.');
        return;
      }

      const tx = {
        validUntil: Math.floor(Date.now() / 1000) + 600,
        messages: [{
          address: 'EQAIrAFcv8a8rU2eNUwZSn-Bwoiifx6uQ8P4wWZsnBxDKPZz', // <-- Ð·Ð°Ð¼ÐµÐ½Ð¸ Ð½Ð° ÑÐ²Ð¾Ð¹ TON-ÐºÐ¾ÑˆÐµÐ»ÐµÐº!
          amount: String(Math.floor(priceTon * 1_000_000_000)),
          payload: ''
        }]
      };

      const result = await tonConnectUI.sendTransaction(tx);
      console.log('âœ… Ð¢Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð°:', result);

      Telegram.WebApp.sendData(JSON.stringify({
        action: 'paid',
        game: gameName,
        tx: result
      }));

      Telegram.WebApp.close();
    } catch (err) {
      console.error('âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ð¿Ð»Ð°Ñ‚Ðµ:', err);
      alert('ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ð¿Ð»Ð°Ñ‚Ðµ Ð¸Ð»Ð¸ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ñ Ð¾Ñ‚Ð¼ÐµÐ½ÐµÐ½Ð°.');
    }
  }
</script>

</body>
</html>

